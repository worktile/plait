---
title: å•å…ƒæµ‹è¯•
order: 5
---


Plait å‰æœŸä¸ºäº†èµ¶è¿›åº¦å•å…ƒæµ‹è¯•ä¸€ç›´æ˜¯ç¼ºå¤±çš„ï¼Œè¿™å°±å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬å†³å®šè¦ç»™æŸä¸€ä¸ªåŠŸèƒ½æˆ–è€…å‡½æ•°æ·»åŠ å•å…ƒæµ‹è¯•æ—¶ï¼Œä¼šæ„Ÿåˆ°æ— ä»ä¸‹æ‰‹ï¼Œä¸€æ–¹é¢æ˜¯é™Œç”Ÿæ„Ÿä¸çŸ¥é“å“ªäº›è¯¥æµ‹é‚£äº›ä¸è¯¥æµ‹ï¼Œä¸€æ–¹é¢ç”±äºæ¶æ„è®¾è®¡çš„åŸå› å‡½æ•°ä¼šä¾èµ–ä¸€äº›æœ‰å‰¯ä½œç”¨çš„ä»£ç ï¼ˆWeakMapï¼‰ï¼Œè¿™äº›å‰¯ä½œç”¨ä¾èµ–ç»„ä»¶è¿è¡ŒååŠ¨æ€æ„å»ºçš„ä¸Šä¸‹æ–‡ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯å•å…ƒæµ‹è¯•ä¹Ÿåº”è¯¥æœ‰ä¸€äº›è§„èŒƒï¼Œè¿™ä¹Ÿæ˜¯å¯¼è‡´æ— ä»ä¸‹æ‰‹çš„ä¸€ä¸ªåŸå› ã€‚å› æ­¤ï¼Œè¿™ä¸¤å¤©ä¸“é—¨èŠ±äº†ä¸€äº›æ—¶é—´è€ƒè™‘äº†ä¸‹å•å…ƒæµ‹è¯•åˆ°åº•è¯¥æ€ä¹ˆå†™ï¼Œå¹¶å°è£…äº†ä¸€äº›æµ‹è¯•ç”¨çš„å·¥å…·å‡½æ•°ï¼ˆä¸»è¦ç”¨äºæ¨¡æ‹Ÿç»„ä»¶è¿è¡Œæ—¶çš„å‰¯ä½œç”¨ä¸Šä¸‹æ–‡ã€æ„å»º board å®ä¾‹ï¼‰ã€‚

åœ¨ plait/mind ä¸­å•å…ƒæµ‹è¯•åº”è¯¥æœ‰ä¸€ä¸ªåˆ†ç±»ï¼š

|åˆ†ç±»|ä¾èµ–ä¸Šä¸‹æ–‡|ç¤ºä¾‹|
|---|---|---|
|çº¯å‡½æ•°|||
|ä¾èµ–å…ƒç´ çˆ¶å­å…³ç³»|ä»£ç ä¸­è°ƒç”¨ï¼š1. PlaitBoard.findPath 2. MindElement.getParent 3. ...|mind/src/utils/abstract/common.spec.ts|
|ä¾èµ–å¸ƒå±€èŠ‚ç‚¹ï¼ˆMindNodeï¼‰|ä»£ç ä¸­ä¾èµ– MindNode|mind/src/utils/position/topic.spec.ts|
|ä¾èµ–æ•°æ®å˜æ¢/æ’ä»¶|ä»£ç ä¸­è°ƒç”¨ Transforms.xxxx å¯¹ board æ•°æ®è¿›è¡Œä¿®æ”¹|mind/src/transforms/emoji.spec.ts|
|ç»„ä»¶å®ä¾‹|å¯¹ç»„ä»¶è¿›è¡Œæµ‹è¯•ï¼Œä¸Šä¸‹æ–‡åˆ™ç›´æ¥åŒ…å«|æš‚æ— |


åˆ†ç±» 1 - çº¯å‡½æ•°ï¼šå•å…ƒæµ‹è¯•æ¯”è¾ƒå¥½å†™ï¼Œæ— é¡»æ¨¡æ‹Ÿä¸Šä¸‹æ–‡ä¾èµ–ï¼›

åˆ†ç±» 2 - ä¾èµ–å…ƒç´ çˆ¶å­å…³ç³»ï¼šéœ€è¦æ¨¡æ‹Ÿæ„å»ºä¸Šä¸‹æ–‡ä¾èµ–ï¼Œè¿™éƒ¨åˆ†ä»£ç å·²ç»è¢«å°è£…åœ¨ plait/core çš„ testing ç›®å½•ä¸­ï¼›

åˆ†ç±» 3 - ä¾èµ–å¸ƒå±€èŠ‚ç‚¹ï¼šéœ€è¦åœ¨æµ‹è¯•ä¸­è°ƒç”¨å¸ƒå±€ç®—æ³•ï¼Œç„¶åæ¨¡æ‹Ÿæ„å»º ELEMENT å’Œ LayoutNode ï¼ˆmindzä¸­çš„ MindNode ç±»å‹ï¼‰çš„å¯¹åº”å…³ç³»ï¼Œè¿™éƒ¨åˆ†ä»£ç è¢«å°è£…åœ¨äº† plait/mind çš„ testing ç›®å½•ä¸­ï¼›

åˆ†ç±» 4 - ä¾èµ–æ•°æ®å˜æ¢/æ’ä»¶ï¼šè¿™é‡Œéœ€è¦æ„å»ºä¸€ä¸ª board å®ä¾‹ï¼Œæ„å»ºæ•°æ®ä¿®æ”¹åŠæ’ä»¶è¿è¡Œç¯å¢ƒï¼Œå¹¶ä¸”éœ€è¦æ”¯æŒä¼ å…¥è‡ªå®šä¹‰æ’ä»¶ï¼Œè¿™ä¹Ÿå±äºæ¡†æ¶é€»è¾‘ï¼Œæ‰€ä»¥è¢«å°è£…åœ¨ plait/core çš„ testing ç›®å½•ä¸­ï¼›

åˆ†ç±» 5 - ç»„ä»¶å®ä¾‹ï¼šå¯¹äºç»„ä»¶çš„æµ‹è¯•ç›®å‰è¿˜æœªå°è£…ï¼Œåç»­å®Œå–„ï¼›



åœ¨å®é™…å†™æµ‹è¯•ä¸­åˆ†ç±» 2 å’Œåˆ†ç±» 3 ä»–ä»¬æ„å»ºä¾èµ–ä¸Šä¸‹æ–‡çš„æµ‹è¯•å¯ä»¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œåˆ›å»º board å®ä¾‹ã€æ„å»ºå…ƒç´ çˆ¶å­å…³ç³»ï¼š

```
let board: PlaitBoard;
beforeEach(() => {
    const children = getTestingChildren();
    board = createTestingBoard([], children);
    fakeNodeWeakMap(board);
});

afterEach(() => {
  	clearNodeWeakMap(board);
});
```

å¦å¤–åˆ†ç±» 3 åœ¨å†™æµ‹è¯•çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œå¦‚æœä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹é‡Œé¢åŒ…å«è¶…è¿‡ä¸€æ¬¡çš„æ•°æ®ä¿®æ”¹ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸€æ¬¡çš„æ•°æ®ä¿®æ”¹åéƒ½éœ€è¦é‡æ–°è°ƒç”¨ fakeNodeWeakmap æ„å»ºåŸºäºæœ€æ–°æ•°æ®å¼•ç”¨çš„çˆ¶å­å…³ç³»ä¾èµ–ï¼š

```
it('should replace emoji success', () => {
    const first = PlaitNode.get<MindElement>(board, [0, 0]);
    const emojiItem: EmojiItem = { name: 'ğŸ˜Š' };
    addEmoji(board, first, emojiItem);
    // need to clear and re-fake weak map because element ref was modified
    clearNodeWeakMap(board);
    fakeNodeWeakMap(board);
    const addFirst = PlaitNode.get<MindElement<EmojiData>>(board, [0, 0]);
    const replaceItem: EmojiItem = { name: 'ğŸ˜­' };
    replaceEmoji(board, addFirst, emojiItem, replaceItem);
    const replaceFirst = PlaitNode.get<MindElement<EmojiData>>(board, [0, 0]);

    expect(replaceFirst.data.emojis.length).toEqual(1);
    expect(replaceFirst.data.emojis[0]).toEqual(replaceItem);
});
```



è¡¥å……å•å…ƒæµ‹è¯•ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡å¾ˆå¥½çš„æ¢³ç†ä»£ç ç»“æ„çš„æœºä¼š



ä¸å¾—ä¸è¯´å†™å•å…ƒæµ‹è¯•æ˜¯ä¸€ä»¶éå¸¸éš¾çš„äº‹æƒ…ï¼Œè€ŒæŠŠå•å…ƒæµ‹è¯•å†™çš„æœ‰æ¡ç†åˆ™æ›´éš¾ï¼Œå› ä¸ºå®ƒé¦–å…ˆéœ€è¦ä½ çš„ä»£ç æ˜¯æœ‰æ¡ç†çš„ï¼ˆæ¨¡å—åˆ’åˆ†æ˜¯å¦æ¸…æ¥šã€è°ƒç”¨å…³ç³»/ç›®å½•å…³ç³»æ˜¯å¦ç»Ÿä¸€ã€å‡½æ•°èŒè´£æ˜¯å¦å”¯ä¸€/æˆ–è€…å­˜åœ¨é‡å¤ï¼‰ï¼Œå¦‚æœä»£ç ç»“æ„ã€è°ƒç”¨å…³ç³»ã€èŒè´£åˆ’åˆ†ç­‰ç­‰ä¸æ¸…æ™°ï¼Œä½ çš„å•å…ƒæµ‹è¯•åˆ™ä¼šå¾ˆæ··ä¹±ï¼ˆæ— æ³•æŒ‰ç…§ä¸€ä¸ªç»Ÿä¸€çš„æ€è·¯æŠŠæ‰€æœ‰çš„åˆ†æ”¯é€»è¾‘å…¨éƒ¨è¦†ç›–ï¼‰ï¼Œæˆ–è€…å‡ºç°é‡å¤åŠŸèƒ½çš„å•å…ƒæµ‹è¯•ï¼Œå¿…ç„¶ä¼šé€ æˆæ—¶é—´çš„æµªè´¹ï¼Œä¹Ÿä¼šæ¶ˆç£¨ç»´æŠ¤å•å…ƒæµ‹è¯•çš„ä¿¡å¿ƒã€‚



